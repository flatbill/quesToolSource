<button class='button is-info'(click)='setDiagnosticsOnOff()'>
  set diagnostics on/off
</button>

<section *ngIf="showDiagHtml" class="bla" >
  <p>hello from quest component.html <br> </p>

  <textarea class="textarea" rows="3">
  Taking the questionnaire
  a. start with an email link, with some credentials baked in
  or start with the website address sumpin.sumpin.com 
     http://localhost:4200/?cust=1&qid=2&icode=12345
     https://stupefied-elion-621b07.netlify.app/?cust=1&qid=2&icode=12345
     batQuest.com?cust=1&qid=2  ( cust is nbr 1, test is nbr 2)
     setup data for each customer in fauna .
     like, custId, custName, paidUpYesOrNo, defaultQid
     read that cust table to see which tests his test takers can run.
     Similar to InviteCode in the old app URL. 
     batQuest.com?cust=1,qid=2,inviteCode=90210
     batQuest.com will be a 'Bill Selzer branded' site, 
     not specific to Ed,
     but maybe each cust could have his own logo.
   
  b. who are you?  how did you get refered here? 
     (establish user, establish some context about this user)
      might show a blank sign on page, might show an already-filled-out sign on page.
      authorize --    establish what test he will see.
      store info about this user taking this test on this date.
      sign on page will then launch the questionnaire component.

      ?????  restrict access to only those with an invite code ?????
      ok for Ed, but what about other customers,
      who might want to open the test up to others.
      maybe this should be an attribute of the test,
      like test47 is invite only.

      hey, when designing test 'control data,
      we need a table with one row per test id.
      make sure the test id is unique, not repeated for different customers.
      like, test47 is for customer harry.  There is no customer besides harry
      that has a test id of 47.


 Running the questionnaire ==================
   determine a test takers questionnaire progress so far.  
     it's time to determine which question set to show next.
     it's time to show a set of questions.
     it's time to store one answer and show one question.
     it's time to score some sets of questions (which sets?)
     
 
  no need for javascript looping.  
  looping (equivalent) is when he clicks an answer.
  to store an answer, call a faunaApi async.
  after we store an answer,   set curQuest variable.  
  curQuest is tied to the hmtl in the SPA.
  This is how we 'ask another question'.
 
  after all the questions have been asked, answered, and scored,
  == do final wrap up.  show 'you are done' screen. 
   
  We probably don't need a question type for intro, break,  finish.
    use each question's aca (answer choice array)
    to format the answer choices on the fly.
    
  message area:  show status of questionnaire progress. show blank if intro/break/finish.
    status 
    askingQuestions 
    storingAnswers
    evaluatingAnswers
    choosingNextQuestions

    answering and scoring
    we record a user answer as an index to aca.
    yes = index of 0   (but we want to store answer value 1)
    no = index of 1    (but we want to store answer value 0)
    we have two sync-ed arrays aca and acaPointVals.
    this is how we tie each answer choice to a point value.
    aca [1,2,3,4,5]  acaPointVals [1,2,3,4,5]
    aca [yes,no]  acaPointVals [1,0]
    aca [indulge,approve,separate,entertain,weaken]  acaPointVals[0,1,0,0,0]
    when he chooses yes it means add 1 to the score.
    when he chooses indulge it means add 0 to the score.
    when he chooses approve it means add 1 to the score.
    in other words,  how many points should be added to the score, 
    when he chooses a particular answer?
    Set ansPoints by using hisacs to find the matching PointVal 
    when he answers a question.  
    -- Store a bunch of info about his answer to a question.
    -- Later, during scoring, apply his answers to scoreboards.


    faunaDb answer async
    we might want to keep a variable AnsDbStoreStatus.
    Set to 'busy' when we call fauna async to store answer.
    set to 'done' when  fauna tells us the answer is stored OK.
    Check AnsDbStoreStatus before ya start scoring.
    that way, all the answers get stored first, 
    and we wont have weird multi-threading for fauna interaction.

    fauna functions ... just some ideas here...

    fetchOneSetOfQuestions key qid questSet
    writeOneAnswer
    do something magical with accumulators and scoreboards
    fetchQidControlRec
    fetchThisTestTakersAnswerHistory
    fetchRules
    fetchScores
    fetchQuser
    fetchCust

    stop writing fauna words in vars and functions,
    start writing qtDb and ansDb words.
    fauna is just the database.  for now.

  subset 
  every question is part of a particular subset.
  after a round of scoring,
  we have a list of subsets to include.
  in other words, we create a filtered list of questions,
  where each question's subset is in the subsetList.
  then we ask a round of questions, and get a round of answers.
  then its time for another round of scoring,
  to create a list of subsets again.
  -----
  repeat this thingie:
  determine which subsets should be in the next qNa round,
  grab those questions that fit the subsetList.
  run a round of qNa,
  score what was just answered in the qNa round.
================================================
answer index1
which qid 
which user
which question
what testDate

he told us an answer
he told us a point value
he told us elapsed time
================================================
 
  </textarea>

<br>
<div class=" has-background-primary " >
  <button class='button is-info'(click)='fetchQtDbTest3()'>fetchQtDbTest3</button>
  <p> qtDbDataQuestTxt: {{ qtDbDataQuestTxt }}</p>
  <p> qtDbRef: {{ qtDbRef }}</p>
</div>
<br>

<div class=" has-background-primary " >
  <button class='button is-info'(click)='fetchQtDbTest5()'>fetchQtDbTest5</button>
  <p> bla</p>
  <p> bla</p>
</div>
<br>


</section>

<section *ngIf="showQuestHtml" class="hero">
  <div class="hero-body">
    <div class="container">
      <h3 class="subtitle has-text-centered"> {{curPreQuest}}  </h3>
      <h2 class='title has-text-centered'> {{curQuestTxt}} </h2>
    </div>
  </div>
</section >

<div *ngIf="showAnswerGroupHtml" class="columns box "> 
  <div class="column " *ngFor="let x of curAca; let i = index">
    <button class='button is-info is-fullwidth'(click)='heAnsweredOneQuestion(i)'>{{x}}</button>
  </div>
</div>



<div *ngIf="showWrapUpHtml" class=" has-background-primary" >  
  Thank you for taking this questionnaire.
  You scored in the top 50.  Congratulations.
</div>
